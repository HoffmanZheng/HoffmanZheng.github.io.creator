---
title: "Database：InnoDB 存储引擎"
author: "Chenghao Zheng"
tags: ["Database"]
categories: ["Reading notes"]
date: 2021-01-07T13:19:47+01:00
draft: false
---

在之前的博客 [Database：MySQL 数据库](https://nervousorange.github.io/2020/database-mysql/) 中笔者已经介绍了自己对于关系型数据库 MySQL 的些许认识，但终觉不够深刻，本篇将结合 [《MySQL技术内幕：InnoDB存储引擎》](https://book.douban.com/subject/24708143/) 讲解作为 MySQL 企业级数据库应用的第一存储引擎 InnoDB 的核心实现和工作机制，主要内容有：缓冲池、线程工作机制、日志文件、锁、事务以及数据的备份与恢复等。

### MySQL 存储引擎

MySQL 数据库区别于其他数据库的最重要的一个特点就是其 **插件式的表存储引擎**（Pluggable Storage Engines），其提供了一系列标准的管理和服务支持，如 SQL 分析器和优化器等，这些标准与存储引擎本身无关，而存储引擎是底层物理结构的实现，每个存储引擎开发者可以按照自己的意愿来进行开发。 MySQL 数据库的体系结构如下图：

【图 1-1】

需要注意的是，存储引擎是 **基于表的**，而不是数据库。每个存储引擎都有各自的特点，开发站应该根据具体的应用选择适合的存储引擎，以下是一些存储引擎的简单介绍：

#### InnoDB

支持事务，行锁，外键，MVCC，实现了 SQL 的4中隔离级别，默认为 REPEATABLE，使用一种被称为next-key locking的策略来避免幻读（phantom）现象的产生；聚集索引，按主键顺序，没指定会自动为每行生成一个6字节的 ROWID

#### MyISAM：

不支持的事务、表锁，支持全文索引，在 5.5.8 之前是默认的存储引擎，只缓存索引文件不缓冲数据文件

#### NDB：

集群存储引擎，数据全部放在内存中，主键查找速度极快，通过添加NDB数据存储节点（Data Node）可以线性地提高数据库性能；有一个问题值得注意，那就是NDB存储引擎的连接操作（JOIN）是在MySQL数据库层完成的，而不是在存储引擎层完成的。这意味着，复杂的连接操作需要巨大的网络开销，因此查询速度很慢

#### Memory：

数据存放于内存，数据库重启或者发生崩溃，表中的数据都将消失，使用了哈希索引，只支持表锁，并发性能较差；MySQL 使用 Memory 存储引擎作为临时表来存放查询的中间结果集；如果中间结果集大于Memory存储引擎表的容量设置，又或者中间结果含有TEXT或BLOB列类型字段，则MySQL数据库会把其转换到MyISAM存储引擎表而存放到磁盘中。之前提到MyISAM不缓存数据文件，因此这时产生的临时表的性能对于查询会有损失

#### Archive：

只支持 INSERT SELECT 操作，支持索引，压缩比例 1：10，非常适合存储归档数据，如日志信息，行锁，并不是事务安全的引擎

### Federated：

不存放数据，它只是指向一台远程MySQL数据库服务器上的表
#### Maria：
它可以看做是MyISAM的后续版本。Maria存储引擎的特点是：支持缓存数据和索引文件，应用了行锁设计，提供了MVCC功能，支持事务和非事务安全的选项，以及更好的BLOB字符类型的处理性能

### InnoDB 存储引擎

#### 缓冲池

#### 线程

### 日志文件

### 锁

### 事务

### 备份与恢复


