---
title: "重构：改善既有代码的设计"
author: "Chenghao Zheng"
tags: ["code"]
categories: ["Reading notes"]
date: 2022-05-02T03:19:47+01:00
draft: false
---

不知道大家有没有发现，编程活动的许多方面，都很难一次做对。可能是对代码的进一步理解，亦或是用户需求的又一次变化，当前的设计可能不再适应于需求。如果容许瑕疵存在，并进一步累积，代码就会变得越来越 **复杂**。在这之后对代码进行的理解、修改或调试，就会变得益发困难起来。

所谓重构，是在不改变代码外在行为的前提下，对程序内部结构的修改，对其设计的改进。虽然重构并不是一件做起来轻松的事，它却能使软件工程具有拥有的生命力。本篇结合 [《重构 (第 2 版)》](https://book.douban.com/subject/30468597/) 从一个开发者的角度讲讲重构，包括但不限于：察觉代码的坏味道、如何安全地重构以及几种重构的场景。本篇不会事无巨细地介绍所有的重构手法，而旨在指出一些值得参考的重构思想。

### 先聊聊测试

重构并 **不总是安全** 的，正如代码的其他改动一样，重构也有可能引入新的 bug。如果当前的工程项目还没有自动测试覆盖，那笔者极力推荐在开始重构之前，先补全对于待重构代码的单元测试。

重构是在保证不改变程序外在行为的前提下做出的设计优化，在没有自动测试的情况下，开发者不得不频繁地在做出改动后手动调试测试程序的功能。这将花费很多时间和精力，并且也不够安全。编写自动测试，可以让计算机来帮我们执行规律且重复的测试动作，测试代码片段对传入参数做出的响应是否符合预期或发生变化。在每一次完成代码重构后，都可以从容地运行测试，来帮助我们检查代码的行为是否受到了影响。

笔者曾就职于国内某民营企业，其部门的项目代码竟没有任何的测试代码，开发者只能在功能上线后再进行手动测试。就算这样，线上事故也频频发生，既存在新上线的功能无法达到预期的问题，也会有老的功能受到代码修改带来的影响。其实有很多的事故，在有了充足的自动测试后，都能被及早的发现，并且可以避免将这些问题暴露给我们的用户。

### 代码可读性

作为优秀的程序员，我们的目的从来不只是写出计算机可以理解的代码，而是写出人类容易理解的代码。

大多数开发者都认为，代码被阅读和被修改的次数远远多于它被编写的次数，而保持代码易读、易修改是重构努力的方向之一。

### 再谈封装

### 优化条件逻辑

### 改善继承关系

### 重构对外接口

